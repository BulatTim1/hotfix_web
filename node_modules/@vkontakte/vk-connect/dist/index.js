"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function __rest(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t}function __spreadArrays(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),o=0;for(n=0;n<t;n++)for(var i=arguments[n],a=0,d=i.length;a<d;a++,o++)r[o]=i[a];return r}function createCounter(){return{current:0,next:function(){return++this.current}}}function createRequestResolver(){var t=createCounter(),o={};return{add:function(e){var n=t.next();return o[n]=e,n},resolve:function(e,n,t){var r=o[e];r&&(t(n)?r.resolve(n):r.reject(n),o[e]=null)}}}function promisifySend(i,e){var a=createRequestResolver();return e(function(e){if(e.detail&&e.detail.data){var n=e.detail.data,t=n.request_id,r=__rest(n,["request_id"]);t&&a.resolve(t,r,function(e){return!("error_type"in e)})}}),function(r,o){return void 0===o&&(o={}),new Promise(function(e,n){var t=null==o.request_id?a.add({resolve:e,reject:n}):o.request_id;i(r,__assign(__assign({},o),{request_id:t}))})}}var IS_CLIENT_SIDE="undefined"!=typeof window,IS_ANDROID_WEBVIEW=Boolean(IS_CLIENT_SIDE&&window.AndroidBridge),IS_IOS_WEBVIEW=Boolean(IS_CLIENT_SIDE&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.VKWebAppClose),IS_WEB=!IS_ANDROID_WEBVIEW&&!IS_IOS_WEBVIEW,EVENT_TYPE=IS_WEB?"message":"VKWebAppEvent",DESKTOP_METHODS=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites","VKWebAppShowCommunityWidgetPreviewBox"],androidBridge=IS_CLIENT_SIDE?window.AndroidBridge:void 0,iosBridge=IS_IOS_WEBVIEW?window.webkit.messageHandlers:void 0;function createVKConnect(t){var i=void 0,a=[];function e(e){a.push(e)}"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener(EVENT_TYPE,function(n){if(IS_IOS_WEBVIEW||IS_ANDROID_WEBVIEW)return __spreadArrays(a).map(function(e){return e.call(null,n)});if(IS_WEB&&n&&n.data){var e=n.data,t=e.type,r=e.data,o=e.frameId;t&&"VKWebAppSettings"===t?i=o:__spreadArrays(a).map(function(e){return e({detail:{type:t,data:r}})})}});var n=promisifySend(function(e,n){androidBridge&&androidBridge[e]?androidBridge[e](JSON.stringify(n)):iosBridge&&iosBridge[e]&&"function"==typeof iosBridge[e].postMessage?iosBridge[e].postMessage(n):IS_WEB&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:i,connectVersion:t},"*")},e);return{send:n,sendPromise:n,subscribe:e,unsubscribe:function(e){var n=a.indexOf(e);-1<n&&a.splice(n,1)},supports:function(e){return IS_ANDROID_WEBVIEW?!(!androidBridge||"function"!=typeof androidBridge[e]):IS_IOS_WEBVIEW?!(!iosBridge||!iosBridge[e]||"function"!=typeof iosBridge[e].postMessage):!!IS_WEB&&-1<DESKTOP_METHODS.indexOf(e)},isWebView:function(){return IS_IOS_WEBVIEW||IS_ANDROID_WEBVIEW}}}function createCustomEventPolyfill(){function e(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),r}return e.prototype=Event.prototype,e}var version="1.9.1";function applyMiddleware(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.includes(void 0)||r.includes(null)?applyMiddleware.apply(void 0,r.filter(function(e){return"function"==typeof e})):function(t){if(0===r.length)return t;var e,n={subscribe:t.subscribe,send:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.send.apply(t,e)}};return e=r.filter(function(e){return"function"==typeof e}).map(function(e){return e(n)}).reduce(function(n,t){return function(e){return n(t(e))}})(t.send),__assign(__assign({},t),{send:e})}}"undefined"==typeof window||window.CustomEvent||(window.CustomEvent=createCustomEventPolyfill());var connect=createVKConnect(version);"undefined"!=typeof module&&module.exports&&(module.exports=__assign({},connect),module.exports.default=__assign({},connect),module.exports.applyMiddleware=applyMiddleware),exports.applyMiddleware=applyMiddleware,exports.default=connect;
