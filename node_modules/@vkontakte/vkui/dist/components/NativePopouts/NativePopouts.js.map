{"version":3,"sources":["../../../src/components/NativePopouts/NativePopouts.js"],"names":["brToNl","str","regex","replace","actionId","NativePopouts","popout","e","type","detail","action","actionsStore","hasOwnProperty","props","onClose","vkuiConnect","subscribe","vkuiListener","renderPopout","unsubscribe","style","title","message","text","send","actions","map","item","actionsLayout","setState","index","autoclose","handler","params","reduce","res","context","isWebView","renderNativeAlert","renderUIAlert","renderNativeSheet","renderUISheet","nextProps","closeUIPopout","Component","component","state","React","PropTypes","oneOfType","shape","oneOf","isRequired","string","func","arrayOf","element","object","bool"],"mappings":"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","sourcesContent":["import React from 'react';\nimport removeObjectKeys from '../../lib/removeObjectKeys';\nimport PropTypes from 'prop-types';\nimport Alert from '../Alert/Alert';\nimport ActionSheet from '../ActionSheet/ActionSheet';\nimport ActionSheetItem from '../ActionSheetItem/ActionSheetItem';\n\nfunction brToNl (str = '') {\n  const regex = /<br\\s*\\/?>/gi;\n\n  return str.replace(regex, '\\n');\n}\n\nlet actionId = 1;\n\n/**\n * @deprecated будет удален в 3.0.0\n */\nexport default class NativePopouts extends React.Component {\n  state = {\n    popout: null\n  };\n\n  actions = [];\n  actionsStore = {};\n\n  static propTypes = {\n    popout: PropTypes.oneOfType([\n      PropTypes.shape({\n        style: PropTypes.oneOf(['alert', 'actionSheet']).isRequired,\n        title: PropTypes.string,\n        text: PropTypes.string,\n        onClose: PropTypes.func.isRequired,\n        actions: PropTypes.arrayOf(PropTypes.shape({\n          style: PropTypes.oneOf(['cancel', 'default', 'destructive']),\n          title: PropTypes.string,\n          action: PropTypes.func\n        }))\n      }),\n      PropTypes.element\n    ]),\n    vkuiConnect: PropTypes.object.isRequired,\n    /**\n     * Root or View\n     */\n    component: PropTypes.func.isRequired\n  };\n\n  static contextTypes = {\n    isWebView: PropTypes.bool\n  };\n\n  componentDidMount () {\n    this.props.vkuiConnect.subscribe(this.vkuiListener);\n    if (this.props.popout) {\n      this.renderPopout(this.props);\n    }\n  }\n\n  componentWillUnmount () {\n    this.props.vkuiConnect.unsubscribe(this.vkuiListener);\n  }\n\n  vkuiListener = (e) => {\n    if (e.type === 'VKWebAppEvent' && e.detail && e.detail.action) {\n      if (this.actionsStore.hasOwnProperty(e.detail.action)) {\n        this.actionsStore[e.detail.action](e.detail);\n        this.props.popout && this.props.popout.onClose && this.props.popout.onClose();\n      }\n    }\n  };\n\n  renderNativeAlert (popout) {\n    const { style, title, text: message } = popout;\n    this.props.vkuiConnect.send('VKWebAppAlert', {\n      style,\n      title: brToNl(title),\n      message: brToNl(message),\n      actions: this.actions.map(item =>\n        removeObjectKeys(item, ['action'])\n      )\n    });\n  }\n\n  renderUIAlert (popout) {\n    const { title, text, onClose, actionsLayout } = popout;\n    this.setState({\n      popout: (<Alert\n        actions={this.actions.map(item => removeObjectKeys(item, ['params']))}\n        onClose={onClose}\n        actionsLayout={actionsLayout}\n      >\n        {title && <h2>{title}</h2>}\n        {text && <p>{text}</p>}\n      </Alert>)\n    });\n  }\n\n  renderNativeSheet (popout) {\n    const { style } = popout;\n    this.props.vkuiConnect.send('VKWebAppAlert', {\n      style,\n      actions: this.actions.map(item => removeObjectKeys(item, ['action']))\n    });\n  }\n\n  renderUISheet (popout) {\n    const { title, text, onClose } = popout;\n    this.setState({\n      popout: (\n        <ActionSheet title={title} text={text} onClose={onClose}>\n          {this.actions.map((item, index) => (\n            <ActionSheetItem autoclose={item.autoclose} theme={item.style} onClick={item.action} key={`${index}`}>\n              {item.title}\n            </ActionSheetItem>\n          ))}\n        </ActionSheet>\n      )\n    });\n  }\n\n  closeUIPopout () {\n    this.setState({ popout: null });\n  }\n\n  renderPopout (props) {\n    if (props.popout.style) {\n      this.actions = props.popout.actions.map((item) => ({\n        ...item,\n        autoclose: item.hasOwnProperty('autoclose') ? item.autoclose : true,\n        action: item.action || props.popout.onClose,\n        handler: { ...item.params, action: `action-${actionId++}` }\n      }));\n\n      this.actionsStore = this.actions.reduce((res, item) => { res[item.handler.action] = item.action; return res; }, {});\n\n      switch (props.popout.style) {\n        case 'alert':\n          this.context.isWebView ? this.renderNativeAlert(props.popout) : this.renderUIAlert(props.popout);\n          break;\n        case 'actionSheet':\n          this.context.isWebView ? this.renderNativeSheet(props.popout) : this.renderUISheet(props.popout);\n          break;\n      }\n    } else {\n      this.setState({ popout: props.popout });\n    }\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (!nextProps.popout && this.props.popout) {\n      this.closeUIPopout();\n    }\n    if (nextProps.popout && nextProps.popout !== this.props.popout) {\n      this.context.isWebView && this.closeUIPopout();\n      this.renderPopout(nextProps);\n    }\n  }\n\n  render () {\n    let Component = this.props.component;\n    return <Component {...removeObjectKeys(this.props, ['popout'])} popout={this.state.popout} />;\n  }\n}\n"],"file":"NativePopouts.js"}