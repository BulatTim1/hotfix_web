{"version":3,"sources":["../../../src/components/Root/Root.js"],"names":["baseClassName","Root","props","e","manual","indexOf","animationName","isBack","state","prevView","nextView","setState","activeView","visibleViews","transition","undefined","window","scrollTo","scrolls","onTransition","from","to","prevProps","prevState","popout","blurActiveElement","pageYOffset","firstLayerId","children","find","view","id","prevViewElement","document","getElementById","nextViewElement","querySelector","scrollTop","waitAnimationFinish","onAnimationEnd","elem","eventHandler","transitionEvents","supported","eventName","prefix","removeEventListener","addEventListener","setTimeout","bind","IS_PLATFORM_ANDROID","activeElement","blur","modal","Views","arrayChildren","filter","View","className","map","context","concat","React","Component","PropTypes","string","isRequired","node","func","any"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from '../../lib/classNames';\nimport getClassName from '../../helpers/getClassName';\n\nimport transitionEvents from '../../lib/transitionEvents';\nimport { IS_PLATFORM_ANDROID } from '../../lib/platform';\n\nconst baseClassName = getClassName('Root');\n\nexport default class Root extends React.Component {\n  constructor (props) {\n    super();\n\n    this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {}\n    };\n  }\n\n  static propTypes = {\n    className: PropTypes.string,\n    activeView: PropTypes.string.isRequired,\n    popout: PropTypes.node,\n    modal: PropTypes.node,\n    onTransition: PropTypes.func,\n    children: PropTypes.node\n  };\n\n  static defaultProps = {\n    popout: null\n  };\n\n  static contextTypes = {\n    window: PropTypes.any,\n    document: PropTypes.any\n  };\n\n  get document () {\n    return this.context.document || document;\n  }\n\n  get window () {\n    return this.context.window || window;\n  }\n\n  get arrayChildren () {\n    return [].concat(this.props.children);\n  }\n\n  componentDidUpdate (prevProps, prevState) {\n    if (this.props.popout && !prevProps.popout) {\n      this.blurActiveElement();\n    }\n\n    if (this.props.activeView !== prevProps.activeView) {\n      let pageYOffset = this.window.pageYOffset;\n      const firstLayerId = prevProps.children.find(view => {\n        return view.props.id === prevProps.activeView || view.props.id === this.props.activeView;\n      }).props.id;\n      const isBack = firstLayerId === this.props.activeView;\n\n      this.blurActiveElement();\n\n      const nextView = this.props.activeView;\n      const prevView = prevProps.activeView;\n\n      this.setState({\n        scrolls: {\n          ...this.state.scrolls,\n          [prevProps.activeView]: pageYOffset\n        },\n        transition: true,\n        activeView: null,\n        nextView,\n        prevView,\n        visibleViews: [nextView, prevView],\n        isBack\n      });\n    }\n\n    if (!prevState.transition && this.state.transition) {\n      const prevViewElement = this.document.getElementById(`view-${this.state.prevView}`);\n      const nextViewElement = this.document.getElementById(`view-${this.state.nextView}`);\n\n      prevViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.prevView];\n\n      if (this.state.isBack) {\n        nextViewElement.querySelector('.View__panel').scrollTop = this.state.scrolls[this.state.nextView];\n      }\n      this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n    }\n  }\n\n  waitAnimationFinish (elem, eventHandler) {\n    if (transitionEvents.supported) {\n      const eventName = transitionEvents.prefix ? transitionEvents.prefix + 'AnimationEnd' : 'animationend';\n\n      elem.removeEventListener(eventName, eventHandler);\n      elem.addEventListener(eventName, eventHandler);\n    } else {\n      setTimeout(eventHandler.bind(this), IS_PLATFORM_ANDROID ? 300 : 600);\n    }\n  }\n\n  onAnimationEnd = (e = { manual: true }) => {\n    if ([\n      'root-android-animation-hide-back',\n      'root-android-animation-show-forward',\n      'root-ios-animation-hide-back',\n      'root-ios-animation-show-forward'\n    ].indexOf(e.animationName) > -1 || e.manual) {\n      const isBack = this.state.isBack;\n      const prevView = this.state.prevView;\n      const nextView = this.state.nextView;\n      this.setState({\n        activeView: nextView,\n        prevView: null,\n        nextView: null,\n        visibleViews: [nextView],\n        transition: false,\n        isBack: undefined\n      }, () => {\n        isBack ? this.window.scrollTo(0, this.state.scrolls[this.state.activeView]) : this.window.scrollTo(0, 0);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevView, to: nextView });\n      });\n    }\n  };\n\n  blurActiveElement () {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      this.document.activeElement.blur();\n    }\n  }\n\n  render () {\n    const { popout, modal } = this.props;\n    const { transition, isBack, prevView, activeView, nextView } = this.state;\n\n    let Views = this.arrayChildren.filter(View => this.state.visibleViews.indexOf(View.props.id) >= 0);\n\n    return (\n      <div className={classNames(baseClassName, this.props.className, { 'Root--transition': transition })}>\n        {Views.map(View => (\n          <div key={View.props.id} id={`view-${View.props.id}`} className={classNames('Root__view', {\n            'Root__view--hide-back': View.props.id === prevView && isBack,\n            'Root__view--hide-forward': View.props.id === prevView && !isBack,\n            'Root__view--show-back': View.props.id === nextView && isBack,\n            'Root__view--show-forward': View.props.id === nextView && !isBack,\n            'Root__view--active': View.props.id === activeView\n          })}>\n            {View}\n          </div>\n        ))}\n        {!!popout && <div className=\"Root__popout\">{popout}</div>}\n        {!!modal && <div className=\"Root__modal\">{modal}</div>}\n      </div>\n    );\n  }\n}\n"],"file":"Root.js"}